pipeline{
    agent any
    triggers{
        cron('H * * * 1-5')
    }
    parameters{
        string (name: 'Testresultspath', 
        defaultValue: 'gameoflife-web/target/surefire-reports/*.xml', 
        description: 'Test Results Path'
        )
        string(
            name: 'ArtifactsToBeArchive',
            defaultValue: 'gameoflife-web/target/*.war',
            description: 'This is archival Path'
        )
        choice(choices: ['DEBUG','RELEASE'], 
        description: 'BUILD TYPE', 
        name: 'BUILD_TYPE')
        choice(
            name: 'BranchToBuild',
            choices: ['declarativepipeline', 'scriptedpipeline', 'master'],
            description: 'Branch to be Build'
        )
    }
        stages{
            stage('git'){
                steps{
                    git branch: "${params.BranchToBuild}", url: 'https://github.com/pkgangisetti/game-of-life.git'
                }
            }
            stage('debug build'){
                when{
                    allOf{
                        expression {params.BUILD_TYPE == 'DEBUG'}
                    }
                }
                steps{
                    sh 'mvn clean package'
                }
            }
            stage('release build'){
                when{
                    allOf{
                        expression {params.BUILD_TYPE == 'RELEASE'}
                    }
                }
                steps{
                    sh 'mvn clean install'
                }
            }
            stage('postbuild'){
                steps{
                    //junit test results
                    junit testResults: "${params.Testresultspath}"

                    // archive the artifacts
                    archive includes: "${params.ArtifactsToBeArchive}"
                }
            }
        }
}